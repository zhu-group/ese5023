<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Section 08 Plotting in R</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computing and Programming for Environmental Research</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Syllabus.html">
    <span class="fa fa-bell-o"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="Schedule.html">
    <span class="fa fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li>
  <a href="Resource.html">
    <span class="fa fa-wrench"></span>
     
    Resource
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Assignment_01.html">Assignment 01</a>
    </li>
    <li>
      <a href="Assignment_02.html">Assignment 02</a>
    </li>
    <li>
      <a href="Assignment_03.html">Assignment 03</a>
    </li>
    <li>
      <a href="Assignment_04.html">Assignment 04</a>
    </li>
    <li>
      <a href="Assignment_05.html">Assignment 05</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Section 08 Plotting in R</h1>

</div>


<blockquote>
<p>“The simple graph has brought more information to the data analyst’s mind than any other device.” - John Tukey</p>
</blockquote>
<div id="plotting-with-ggplot2" class="section level1">
<h1>Plotting with ggplot2</h1>
<p><em>This section is modified from the excellent <a href="https://r4ds.had.co.nz/data-visualisation.html#introduction-1">Data visualisation</a> and <a href="http://r-statistics.co/ggplot2-Tutorial-With-R.html">How to make any plot in ggplot2?</a>, both are freely available online.</em></p>
<p><code>ggplot2</code> is the most elegant and aesthetically pleasing graphics framework available in R. It implements the <strong>grammar of graphics</strong>, a coherent system for describing and building graphs. It can significantly improve your plots’ quality and make you much more efficient in creating them. With that being said, the learning curve is steep because the way you make plots with <code>ggplot2</code> is very different from base graphics making in R and in other languages. The distinctive feature of the <code>ggplot2</code> framework is the way you make plots through <strong>adding layers</strong>. Here we will learn the steps of making a plot with <code>ggplot2</code>. <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div id="step-1.-passing-the-data-set" class="section level2">
<h2>Step 1. Passing the data set</h2>
<p>First of all, you need to tell R what data set to use in plotting. This is done by passing a <em>data.frame</em> object to the <code>ggplot()</code> function. Here the data frame object should contain <strong>all</strong> features needed to make the plot you want. Unlike base graphics in R and other languages, <code>ggplot()</code> does not take vectors as arguments.</p>
<p>In previous sections, you learn how to use the pipe operator (<code>%&gt;%</code>) to pass a data set (<code>tibble</code> object) produced through <a href="https://zhu-group.github.io/ese5023/Section_05.html">data wrangling</a> to the <code>ggplot()</code> function. This is exactly what you need to do in this step.</p>
<p>Let’s use the <code>gapminder</code> data set again. Now suppose we want to look at how GCP per capita (<code>gdpPercap</code>) changes from 1957 to 2007 for countries with names starting with the letter “C” in Asia or Europe. (I make up this subjective example, but hopefully, you can see the power of the <code>dplyr</code> package!) We can then pass the subset of <code>gapminder</code> data to <code>ggplot</code> to make a scatter plot between <code>gdpPercap</code> and <code>year</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load libraries</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># Make a simple scatter plot</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="Section_08_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
</div>
<div id="step-2.-mapping-the-aesthetics" class="section level2">
<h2>Step 2. Mapping the aesthetics</h2>
<p>The plot above, however, can not distinguish countries as all points are plotted in the same manner. In fact, we would like to add <code>country</code> as the <strong>third</strong> variable to the two dimensional scatter plot. By doing so, we are mapping the scatter plot to an <strong><em>aesthetic</em></strong>. An aesthetic is a visual property of the objects in your plot. Aesthetics include things like the <code>size</code>, <code>shape</code>, <code>color</code>, or even transparency (<code>alpha</code>) of the points. You can display a point (like the one below) in different ways by changing the values of its aesthetic properties.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">color=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="Section_08_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>To map an aesthetic to a variable, associate the name of the aesthetic to the name of the variable inside <code>aes()</code>. <code>ggplot2</code> will automatically assign a unique level of the aesthetic (here a unique color) to each unique value of the variable, a process known as <em>scaling</em>. <code>ggplot2</code> will also add a <em>legend</em> that explains which levels correspond to which values.</p>
<p>In the above example, we mapped <code>country</code> to the <code>color</code> aesthetic, but we could have mapped <code>country</code> to the <code>size</code> aesthetic in the same way. In this case, the exact size of each point would reveal its class affiliation.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">size=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="Section_08_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>We get a warning here, because mapping an unordered variable (<code>country</code>) to an ordered aesthetic (<code>size</code>) is not a good idea. We can ignore the warning for now.</p>
<p>Similarly, we could map <code>country</code> to the <code>shape</code> or <code>alpha</code> aesthetic:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">shape=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="Section_08_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">alpha=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p><img src="Section_08_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<p>You can even combine more than one aesthetic:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">color=</span>country, <span class="dt">shape=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="Section_08_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">color=</span>country, <span class="dt">shape=</span>continent, <span class="dt">size=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="Section_08_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Once you map an aesthetic, <code>ggplot2</code> takes care of the rest. It selects a reasonable scale to use with the aesthetic, and it constructs a legend that explains the mapping between levels and values.</p>
</div>
<div id="step-3.-adding-more-geometric-objects" class="section level2">
<h2>Step 3. Adding more geometric objects</h2>
<p>In the previous steps, we make a scatter plot between <code>gdpPercap</code> and <code>year</code>. The plot uses a visual object to represent the data. In ggplot2 syntax, we say the plot uses a geometrical object or <strong>geom</strong>.</p>
<p>People often describe plots by the type of geom that the plot uses. For example, bar charts use bar geoms, line charts use line geoms, boxplots use boxplot geoms, and so on. <code>ggplot2</code> provides over 40 geoms, and extension packages provide even more (see <a href="https://exts.ggplot2.tidyverse.org/gallery/">here</a> for a sampling). The best way to get a comprehensive overview is <a href="https://rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf">ggplot2 cheatsheet</a>. To learn more about any single geom, use <code>?</code>, for example <code>?geom_smooth</code>.</p>
<p>In <code>ggplot2</code>, you can use “+” to add another geom to the plot. In the plot below, we add a smoothed line to the scatter plots from the individual country.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">color=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Section_08_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="step-4.-changing-the-labels" class="section level2">
<h2>Step 4. Changing the labels</h2>
<p>Now that you have drawn the main parts of the plot. You might want to add the plot’s main title and perhaps change the X and Y axis titles. This can be accomplished using the <code>labs</code> layer, meant for specifying the labels. However, manipulating the size, the color of the labels is the job of the ‘Theme’.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">color=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Year&quot;</span>, <span class="dt">y=</span><span class="st">&quot;GDP per captia&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Section_08_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="step-5.-adjusting-the-theme" class="section level2">
<h2>Step 5. Adjusting the theme</h2>
<p>Very often, we want to customize our plot to make it looks better. For example we may need to increase the size of the labels and/or change the legend title. Adjusting the size of labels can be done using the <code>theme()</code> function by setting the<code>plot.title</code>, <code>axis.text.x</code>, and <code>axis.text.y</code> option. They need to be specified inside the <code>element_text()</code>. If you want to remove any of them, set it to <code>element_blank()</code>, and it will vanish entirely.</p>
<p>Adjusting the legend title is a bit tricky. If your legend is that of a <code>color</code> attribute and it varies based on a factor, you need to set the <code>name</code> using the <code>scale_color_discrete()</code> function, where the color part belongs to the color attribute and the <strong>discrete</strong> because the legend is based on a factor variable.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">color=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Year&quot;</span>, <span class="dt">y=</span><span class="st">&quot;GDP per captia&quot;</span>) <span class="op">+</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>), </span>
<span id="cb15-10"><a href="#cb15-10"></a>        <span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>), </span>
<span id="cb15-11"><a href="#cb15-11"></a>        <span class="dt">axis.text.y=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>),</span>
<span id="cb15-12"><a href="#cb15-12"></a>        <span class="dt">axis.title.x=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>),</span>
<span id="cb15-13"><a href="#cb15-13"></a>        <span class="dt">axis.title.y=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Country Name&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Section_08_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="step-6.-using-the-facets" class="section level2">
<h2>Step 6. Using the facets</h2>
<p>For categorical variables, it is particularly useful to split your plot into <strong>facets</strong>, subplots that each display one subset of the data. To facet your plot by a single variable, use <code>facet_wrap()</code>. The first argument of <code>facet_wrap()</code> should be a formula, which you create with <code>~</code> followed by a variable name. The variable that you pass to <code>facet_wrap()</code> should be discrete.</p>
<p>Let’s split our plot into two facets based on <code>continent</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">color=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Year&quot;</span>, <span class="dt">y=</span><span class="st">&quot;GDP per captia&quot;</span>) <span class="op">+</span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>), </span>
<span id="cb17-10"><a href="#cb17-10"></a>        <span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>), </span>
<span id="cb17-11"><a href="#cb17-11"></a>        <span class="dt">axis.text.y=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>),</span>
<span id="cb17-12"><a href="#cb17-12"></a>        <span class="dt">axis.title.x=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>),</span>
<span id="cb17-13"><a href="#cb17-13"></a>        <span class="dt">axis.title.y=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb17-14"><a href="#cb17-14"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Country Name&quot;</span>) <span class="op">+</span></span>
<span id="cb17-15"><a href="#cb17-15"></a><span class="st">  </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>continent)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Section_08_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>One way to change the layout the facets is specifying <code>ncol</code> and <code>nrow</code> options in the <code>facet_wrap()</code> function:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">color=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Year&quot;</span>, <span class="dt">y=</span><span class="st">&quot;GDP per captia&quot;</span>) <span class="op">+</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>), </span>
<span id="cb19-10"><a href="#cb19-10"></a>        <span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>), </span>
<span id="cb19-11"><a href="#cb19-11"></a>        <span class="dt">axis.text.y=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>),</span>
<span id="cb19-12"><a href="#cb19-12"></a>        <span class="dt">axis.title.x=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>),</span>
<span id="cb19-13"><a href="#cb19-13"></a>        <span class="dt">axis.title.y=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb19-14"><a href="#cb19-14"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Country Name&quot;</span>) <span class="op">+</span></span>
<span id="cb19-15"><a href="#cb19-15"></a><span class="st">  </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>continent, <span class="dt">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Section_08_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="step-7.-saving-the-plot" class="section level2">
<h2>Step 7. Saving the plot</h2>
<p>Finally, you can save the above plot uisng the <code>ggsave()</code> function. The default is to save the last plot that you displayed, using the size of the current graphics device. It’s smart enough to guess the type of graphics device from the extension. Let’s save the above figure to a local path <code>D://class</code> with a name <code>myplot.png</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">color=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Year&quot;</span>, <span class="dt">y=</span><span class="st">&quot;GDP per captia&quot;</span>) <span class="op">+</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>), </span>
<span id="cb21-10"><a href="#cb21-10"></a>        <span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>), </span>
<span id="cb21-11"><a href="#cb21-11"></a>        <span class="dt">axis.text.y=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>),</span>
<span id="cb21-12"><a href="#cb21-12"></a>        <span class="dt">axis.title.x=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>),</span>
<span id="cb21-13"><a href="#cb21-13"></a>        <span class="dt">axis.title.y=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb21-14"><a href="#cb21-14"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Country Name&quot;</span>) <span class="op">+</span></span>
<span id="cb21-15"><a href="#cb21-15"></a><span class="st">  </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>continent, <span class="dt">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Section_08_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>  <span class="kw">ggsave</span>(<span class="st">&quot;myplot.png&quot;</span>)  <span class="co"># save a stored ggplot</span></span></code></pre></div>
<pre><code>## Saving 7 x 5 in image
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p>You can also change the plot size (<code>width</code> and <code>height</code>) and resolution (<code>dpi</code>) by setting corresponding options. Use <code>?ggsave()</code> for more.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Save a ggplot object</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>plot1 &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( continent<span class="op">==</span><span class="st">&quot;Asia&quot;</span> <span class="op">|</span><span class="st"> </span>continent<span class="op">==</span><span class="st">&quot;Europe&quot;</span> ) <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>( <span class="kw">substr</span>(country,<span class="dv">1</span>,<span class="dv">1</span>)<span class="op">==</span><span class="st">&quot;C&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="st">  </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>gdpPercap, <span class="dt">color=</span>country) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;GDP per captia from 1957 to 2007&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Year&quot;</span>, <span class="dt">y=</span><span class="st">&quot;GDP per captia&quot;</span>) <span class="op">+</span></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>), </span>
<span id="cb25-11"><a href="#cb25-11"></a>        <span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>), </span>
<span id="cb25-12"><a href="#cb25-12"></a>        <span class="dt">axis.text.y=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>),</span>
<span id="cb25-13"><a href="#cb25-13"></a>        <span class="dt">axis.title.x=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>),</span>
<span id="cb25-14"><a href="#cb25-14"></a>        <span class="dt">axis.title.y=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb25-15"><a href="#cb25-15"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Country Name&quot;</span>) <span class="op">+</span></span>
<span id="cb25-16"><a href="#cb25-16"></a><span class="st">  </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>continent, <span class="dt">nrow=</span><span class="dv">2</span>)</span>
<span id="cb25-17"><a href="#cb25-17"></a></span>
<span id="cb25-18"><a href="#cb25-18"></a><span class="co"># And later save it to a stored figure</span></span>
<span id="cb25-19"><a href="#cb25-19"></a><span class="kw">ggsave</span>(<span class="st">&quot;myplot2.png&quot;</span>, <span class="dt">plot=</span>plot1, <span class="dt">width=</span><span class="dv">20</span>,</span>
<span id="cb25-20"><a href="#cb25-20"></a>       <span class="dt">height=</span><span class="dv">10</span>, <span class="dt">units=</span><span class="st">&quot;cm&quot;</span>, <span class="dt">dpi=</span><span class="dv">400</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
</div>
<div id="ggplot2s-grammar-of-graphics-and-beyond" class="section level2">
<h2>ggplot2’s grammar of graphics and beyond</h2>
<p>We have covered some basics but critical steps of making plots with <code>ggplot2</code>. There are many more features that we don’t have time to go through in just one section. You can explore the full functionality of <code>ggplot2()</code> by studying the <a href="https://zhu-group.github.io/ese5023/Section_08.html#Further_reading">further reading</a> listed at the end.</p>
<p>To summarize, ggplot2’s grammar of graphics goes like:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="op">&lt;</span>DATA<span class="op">&gt;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="st">  </span><span class="er">&lt;</span>GEOM_FUNCTION<span class="op">&gt;</span>(</span>
<span id="cb27-3"><a href="#cb27-3"></a>     <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="op">&lt;</span>MAPPINGS<span class="op">&gt;</span>),</span>
<span id="cb27-4"><a href="#cb27-4"></a>     <span class="dt">stat =</span> <span class="op">&lt;</span>STAT<span class="op">&gt;</span>, </span>
<span id="cb27-5"><a href="#cb27-5"></a>     <span class="dt">position =</span> <span class="op">&lt;</span>POSITION<span class="op">&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="st">  </span>) <span class="op">+</span></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="st">  </span><span class="er">&lt;</span>COORDINATE_FUNCTION<span class="op">&gt;</span><span class="st"> </span><span class="op">+</span></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="st">  </span><span class="er">&lt;</span>FACET_FUNCTION<span class="op">&gt;</span></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="st">  </span></span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="kw">ggsave</span>()  </span></code></pre></div>
<p>The template takes <em>seven parameters</em>, the bracketed words that appear in the template. We have no time to cover <code>STAT</code>, <code>POSITION</code>, and <code>COORDINATE_FUNCTION</code>, which you can learn by yourself following the <a href="https://zhu-group.github.io/ese5023/Section_08.html#Further_reading">further reading</a>. In practice, you rarely need to supply all seven parameters to make a plot because <code>ggplot2</code> will provide useful defaults for everything except the data, the mappings, and the geom function.</p>
<p>The seven parameters in the template compose the grammar of graphics, a formal system for building plots. The grammar of graphics is based on the insight that you can uniquely describe any plot as a combination of a data set, a geom, a set of mappings, a stat, a position adjustment, a coordinate system, and a faceting scheme.</p>
<p>With this, you can make any type of plot with <code>ggplot2()</code>!</p>
</div>
<div id="r-graph-gallery" class="section level2">
<h2>R Graph Gallery</h2>
<p>A good way to learn <code>ggplot2</code> is to browse plots (and scripts!) in the R Graph Gallery, such as:</p>
<ul>
<li><a href="https://www.r-graph-gallery.com/index.html">The R Graph Gallery</a></li>
<li><a href="http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html">Top 50 ggplot2 Visualizations</a></li>
<li><a href="https://exts.ggplot2.tidyverse.org/gallery/">ggplot2 extensions</a></li>
<li><a href="https://plotly.com/r/">Plotly R Open Source Graphing Library</a></li>
</ul>
<p>Find the plots you want to mimic, edit and customize the scripts based on your need.</p>
<hr />
</div>
</div>
<div id="image-plot" class="section level1">
<h1>Image plot</h1>
<p>In our field, we plot 2-D maps with values very often. Again, you can learn how to do so with <code>ggplot2</code>, see <a href="https://ggplot2-book.org/maps.html">ggplot2: Elegant Graphics for Data Analysis</a> for more. But for now, let’s learn how to do this using the <code>image.plot()</code> function.</p>
<p>Install <code>fields</code>, <code>maps</code>, and <code>RNetCDF</code> packages if you haven’t:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;fields&quot;</span>)</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="kw">install.packages</span>(<span class="st">&quot;maps&quot;</span>)</span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="kw">install.packages</span>(<span class="st">&quot;RNetCDF&quot;</span>)</span></code></pre></div>
<p>Here we will use <a href="https://psl.noaa.gov/data/gridded/data.crutem4.html">Jones (CRU) Air Temperature Anomalies Version 4: CRUTEM4</a>, which contains global gridded (5°x5°) monthly anomalies of observed air temperature and combined observed air and marine temperature (HADCRU4) from the 1800s to near present. The current version is V4.2.0, which was put out on 5/9/2013. Download the <a href="https://zhu-group.github.io/ese5023/download/air.mon.ltm.nc">monthly long term mean surface data</a>, and move it to your <code>working directory</code>.</p>
<p>The data set is in the <a href="https://www.unidata.ucar.edu/software/netcdf/">Network Common Data Form (NetCDF)</a> format. NetCDF file is self-describing. A netCDF file includes information about the data it contains. It is widely used in Earth Science, Remote Sensing, and Environmental Science.</p>
<div id="reading-a-netcdf-file" class="section level2">
<h2>Reading a NetCDF file</h2>
<p>Before plotting, we need to read the NetCDF file using functions in the <code>RNetCDF</code> package.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">library</span>(fields); <span class="kw">library</span>(maps); <span class="kw">library</span>(RNetCDF)</span></code></pre></div>
<pre><code>## Warning: package &#39;fields&#39; was built under R version 4.0.3</code></pre>
<pre><code>## Loading required package: spam</code></pre>
<pre><code>## Warning: package &#39;spam&#39; was built under R version 4.0.3</code></pre>
<pre><code>## Loading required package: dotCall64</code></pre>
<pre><code>## Warning: package &#39;dotCall64&#39; was built under R version 4.0.3</code></pre>
<pre><code>## Loading required package: grid</code></pre>
<pre><code>## Spam version 2.5-1 (2019-12-12) is loaded.
## Type &#39;help( Spam)&#39; or &#39;demo( spam)&#39; for a short introduction 
## and overview of this package.
## Help for individual functions is also obtained by adding the
## suffix &#39;.spam&#39; to the function name, e.g. &#39;help( chol.spam)&#39;.</code></pre>
<pre><code>## 
## Attaching package: &#39;spam&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     backsolve, forwardsolve</code></pre>
<pre><code>## See https://github.com/NCAR/Fields for
##  an extensive vignette, other supplements and source code</code></pre>
<pre><code>## Warning: package &#39;maps&#39; was built under R version 4.0.3</code></pre>
<pre><code>## Warning: package &#39;RNetCDF&#39; was built under R version 4.0.3</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># Open the NetCDF file</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>ex.nc     &lt;-<span class="st"> </span><span class="kw">open.nc</span>(<span class="st">&quot;air.mon.ltm.nc&quot;</span>)</span>
<span id="cb42-3"><a href="#cb42-3"></a></span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="co"># Print the variables and attributes</span></span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="kw">print.nc</span>(ex.nc)</span></code></pre></div>
<pre><code>## netcdf classic {
## dimensions:
##  time = UNLIMITED ; // (12 currently)
##  lat = 36 ;
##  lon = 72 ;
##  nbnds = 2 ;
## variables:
##  NC_FLOAT lat(lat) ;
##      NC_CHAR lat:long_name = &quot;Latitude&quot; ;
##      NC_CHAR lat:units = &quot;degrees_north&quot; ;
##      NC_FLOAT lat:actual_range = 87.5, -87.5 ;
##      NC_CHAR lat:standard_name = &quot;latitude&quot; ;
##      NC_CHAR lat:axis = &quot;Y&quot; ;
##      NC_CHAR lat:coordinate_defines = &quot;point&quot; ;
##  NC_FLOAT lon(lon) ;
##      NC_CHAR lon:long_name = &quot;Longitude&quot; ;
##      NC_CHAR lon:units = &quot;degrees_east&quot; ;
##      NC_FLOAT lon:actual_range = -177.5, 177.5 ;
##      NC_CHAR lon:axis = &quot;X&quot; ;
##      NC_CHAR lon:coordinate_defines = &quot;point&quot; ;
##      NC_CHAR lon:standard_name = &quot;longitude&quot; ;
##  NC_DOUBLE time(time) ;
##      NC_CHAR time:units = &quot;days since 1800-01-01 00:00:0.0&quot; ;
##      NC_CHAR time:long_name = &quot;Time&quot; ;
##      NC_CHAR time:delta_t = &quot;0000-01-00 00:00:00&quot; ;
##      NC_CHAR time:avg_period = &quot;0030-00-00 00:00:00&quot; ;
##      NC_DOUBLE time:actual_range = -657073, -656739 ;
##      NC_DOUBLE time:ltm_range = 58804, 69730 ;
##      NC_CHAR time:axis = &quot;T&quot; ;
##      NC_CHAR time:standard_name = &quot;time&quot; ;
##      NC_CHAR time:coordinate_defines = &quot;start&quot; ;
##      NC_CHAR time:climatology = &quot;climatological_bounds&quot; ;
##  NC_DOUBLE climatological_bounds(nbnds, time) ;
##      NC_CHAR climatological_bounds:long_name = &quot;Climatology Boundaries&quot; ;
##      NC_CHAR climatological_bounds:units = &quot;days since 1800-1-1 00:00:0.0&quot; ;
##  NC_FLOAT air(lon, lat, time) ;
##      NC_CHAR air:dataset = &quot;HADCRUT2V&quot; ;
##      NC_CHAR air:var_desc = &quot;Air Temperature&quot; ;
##      NC_CHAR air:level_desc = &quot;Surface&quot; ;
##      NC_CHAR air:statistic = &quot;Long Term Mean&quot; ;
##      NC_FLOAT air:valid_range = -88, 88 ;
##      NC_FLOAT air:actual_range = -70.2999954223633, 35.7000007629395 ;
##      NC_CHAR air:units = &quot;degC&quot; ;
##      NC_FLOAT air:missing_value = -9.96920996838687e+36 ;
##      NC_CHAR air:long_name = &quot;CRU Combined Surface/Marine Air Temperature Monthly Climatology&quot; ;
##      NC_SHORT air:precision = 2 ;
##      NC_FLOAT air:add_offset = 0 ;
##      NC_FLOAT air:scale_factor = 1 ;
##      NC_CHAR air:cell_methods = &quot;time: mean within months time: mean over years&quot; ;
##      NC_CHAR air:standard_name = &quot;air_temperature&quot; ;
## 
## // global attributes:
##      NC_CHAR :platform = &quot;Surface&quot; ;
##      NC_CHAR :title = &quot;CRU Combined Surface/Marine Air Temperature Climatology 1961-1990.&quot; ;
##      NC_CHAR :history = &quot;Created at NOAA-CIRES CDC by CAS 5/05&quot; ;
##      NC_CHAR :Conventions = &quot;CF-1.0&quot; ;
##      NC_CHAR :References = &quot;http://www.psl.noaa.gov/data/gridded/data.hadcru3.html&quot; ;
##      NC_CHAR :Source = &quot;http://www.cru.uea.ac.uk/cru/data/temperature/&quot; ;
##      NC_CHAR :dataset_title = &quot;HadCRU2&quot; ;
## }</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># Read the variables</span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="co"># Lat</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>Lat       &lt;-<span class="st"> </span><span class="kw">var.get.nc</span>(ex.nc, <span class="st">&quot;lat&quot;</span>)</span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="co"># Lon</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>Lon       &lt;-<span class="st"> </span><span class="kw">var.get.nc</span>(ex.nc, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb44-6"><a href="#cb44-6"></a><span class="co"># Monthly long term mean, surface temperature [degC]</span></span>
<span id="cb44-7"><a href="#cb44-7"></a>Air_T     &lt;-<span class="st"> </span><span class="kw">var.get.nc</span>(ex.nc, <span class="st">&quot;air&quot;</span>) </span>
<span id="cb44-8"><a href="#cb44-8"></a></span>
<span id="cb44-9"><a href="#cb44-9"></a><span class="co"># Close the NetCDF file</span></span>
<span id="cb44-10"><a href="#cb44-10"></a><span class="kw">close.nc</span>(ex.nc)</span></code></pre></div>
</div>
<div id="making-an-image-plot" class="section level2">
<h2>Making an image plot</h2>
<p>Let’s plot the mean surface temperature in Jan. (<code>Air_T_Jan</code>). Since <code>image.plot()</code> requires an <strong>increasing</strong> order of both X and Y axes, we have to do some data transformation before plotting them.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Original Lat is in decreasing order, we need to reverse it</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>Lat &lt;-<span class="st"> </span><span class="kw">rev</span>(Lat)</span>
<span id="cb45-3"><a href="#cb45-3"></a></span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="co"># Data transformation of Air_T_Jan</span></span>
<span id="cb45-5"><a href="#cb45-5"></a>Air_T_Jan &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>,<span class="dt">dim=</span><span class="kw">c</span>(<span class="kw">length</span>(Lon), <span class="kw">length</span>(Lat)))</span>
<span id="cb45-6"><a href="#cb45-6"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Lat)){</span>
<span id="cb45-7"><a href="#cb45-7"></a>  Air_T_Jan[,row] &lt;-<span class="st"> </span>Air_T[, (<span class="kw">length</span>(Lat)<span class="op">+</span><span class="dv">1</span><span class="op">-</span>row),<span class="dv">1</span> ]</span>
<span id="cb45-8"><a href="#cb45-8"></a>}</span></code></pre></div>
<p>Plot the matrix with <code>image.plot()</code>:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">image.plot</span>(Lon, Lat, Air_T_Jan)</span></code></pre></div>
<p><img src="Section_08_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>We can make the plot look better by setting more options:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># Set margins on bottom, left, top, right</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">4.5</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb47-3"><a href="#cb47-3"></a></span>
<span id="cb47-4"><a href="#cb47-4"></a><span class="co"># Plot</span></span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="kw">image.plot</span>(Lon, Lat, Air_T_Jan,</span>
<span id="cb47-6"><a href="#cb47-6"></a>           <span class="dt">horizontal=</span>T, <span class="dt">useRaster=</span>T,</span>
<span id="cb47-7"><a href="#cb47-7"></a>           <span class="dt">legend.shrink=</span><span class="fl">0.75</span>, <span class="dt">axis.args=</span><span class="kw">list</span>(<span class="dt">cex.axis =</span> <span class="fl">1.25</span>), </span>
<span id="cb47-8"><a href="#cb47-8"></a>           <span class="dt">legend.width=</span><span class="dv">1</span>, <span class="dt">legend.mar=</span><span class="dv">2</span>,</span>
<span id="cb47-9"><a href="#cb47-9"></a>           <span class="dt">legend.args=</span><span class="kw">list</span>(<span class="dt">text=</span><span class="st">&quot;Surface Temperature [degC]&quot;</span>,<span class="dt">cex=</span><span class="fl">1.25</span>),           </span>
<span id="cb47-10"><a href="#cb47-10"></a>           <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;&#39;</span>,<span class="dt">midpoint=</span>T, <span class="dt">axes=</span>F, <span class="dt">ann=</span>F</span>
<span id="cb47-11"><a href="#cb47-11"></a>)</span>
<span id="cb47-12"><a href="#cb47-12"></a><span class="kw">title</span>(<span class="dt">xlab=</span><span class="st">&quot;&quot;</span>,<span class="dt">cex.lab=</span><span class="fl">1.25</span>,<span class="dt">font.lab=</span><span class="dv">2</span>)</span>
<span id="cb47-13"><a href="#cb47-13"></a><span class="kw">axis</span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="kw">pretty</span>(Lon),<span class="dt">tck=</span><span class="op">-</span><span class="fl">0.015</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">cex.axis=</span><span class="fl">1.25</span>,<span class="dt">font=</span><span class="dv">1</span>)</span>
<span id="cb47-14"><a href="#cb47-14"></a><span class="kw">title</span>(<span class="dt">ylab=</span><span class="st">&quot;&quot;</span>,<span class="dt">cex.lab=</span><span class="fl">1.25</span>,<span class="dt">font.lab=</span><span class="dv">2</span>)</span>
<span id="cb47-15"><a href="#cb47-15"></a><span class="kw">axis</span>(<span class="dv">2</span>,<span class="dt">at=</span><span class="kw">pretty</span>(Lat),<span class="dt">tck=</span><span class="op">-</span><span class="fl">0.015</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">cex.axis=</span><span class="fl">1.25</span>,<span class="dt">font=</span><span class="dv">1</span>,<span class="dt">las=</span><span class="dv">1</span>)</span>
<span id="cb47-16"><a href="#cb47-16"></a><span class="kw">title</span>(<span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;Long term (1800-2020) mean surface temperature in Jan.&quot;</span>),</span>
<span id="cb47-17"><a href="#cb47-17"></a>      <span class="dt">cex.main=</span><span class="dv">1</span>,<span class="dt">font.main=</span><span class="dv">2</span>)</span>
<span id="cb47-18"><a href="#cb47-18"></a></span>
<span id="cb47-19"><a href="#cb47-19"></a><span class="co"># Add map</span></span>
<span id="cb47-20"><a href="#cb47-20"></a><span class="kw">map</span>(<span class="st">&#39;world&#39;</span>,<span class="dt">add=</span>T,<span class="dt">lwd=</span><span class="fl">0.75</span>,<span class="dt">col=</span><span class="st">&quot;black&quot;</span>)</span>
<span id="cb47-21"><a href="#cb47-21"></a></span>
<span id="cb47-22"><a href="#cb47-22"></a><span class="co"># Add a box</span></span>
<span id="cb47-23"><a href="#cb47-23"></a><span class="kw">box</span>(<span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Section_08_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Use <code>?image.plot()</code> to learn more about the options.</p>
<p>Finally, we can save the above plot as:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># Set the png format</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="kw">png</span>(<span class="st">&quot;Surface_T.png&quot;</span>, <span class="dt">width=</span><span class="fl">8.5</span>, <span class="dt">height=</span><span class="dv">6</span>, <span class="dt">units=</span><span class="st">&quot;in&quot;</span>, <span class="dt">res=</span><span class="dv">400</span>) </span>
<span id="cb48-3"><a href="#cb48-3"></a></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="co"># Set margins on bottom, left, top, right</span></span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">4.5</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb48-6"><a href="#cb48-6"></a></span>
<span id="cb48-7"><a href="#cb48-7"></a><span class="co"># Plot</span></span>
<span id="cb48-8"><a href="#cb48-8"></a><span class="kw">image.plot</span>(Lon, Lat, Air_T_Jan,</span>
<span id="cb48-9"><a href="#cb48-9"></a>           <span class="dt">horizontal=</span>T, <span class="dt">useRaster=</span>T,</span>
<span id="cb48-10"><a href="#cb48-10"></a>           <span class="dt">legend.shrink=</span><span class="fl">0.75</span>, <span class="dt">axis.args=</span><span class="kw">list</span>(<span class="dt">cex.axis =</span> <span class="fl">1.25</span>), </span>
<span id="cb48-11"><a href="#cb48-11"></a>           <span class="dt">legend.width=</span><span class="dv">1</span>, <span class="dt">legend.mar=</span><span class="dv">2</span>,</span>
<span id="cb48-12"><a href="#cb48-12"></a>           <span class="dt">legend.args=</span><span class="kw">list</span>(<span class="dt">text=</span><span class="st">&quot;Surface Temperature [degC]&quot;</span>,<span class="dt">cex=</span><span class="fl">1.25</span>),           </span>
<span id="cb48-13"><a href="#cb48-13"></a>           <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;&#39;</span>,<span class="dt">midpoint=</span>T, <span class="dt">axes=</span>F, <span class="dt">ann=</span>F</span>
<span id="cb48-14"><a href="#cb48-14"></a>)</span>
<span id="cb48-15"><a href="#cb48-15"></a><span class="kw">title</span>(<span class="dt">xlab=</span><span class="st">&quot;&quot;</span>,<span class="dt">cex.lab=</span><span class="fl">1.25</span>,<span class="dt">font.lab=</span><span class="dv">2</span>)</span>
<span id="cb48-16"><a href="#cb48-16"></a><span class="kw">axis</span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="kw">pretty</span>(Lon),<span class="dt">tck=</span><span class="op">-</span><span class="fl">0.015</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">cex.axis=</span><span class="fl">1.25</span>,<span class="dt">font=</span><span class="dv">1</span>)</span>
<span id="cb48-17"><a href="#cb48-17"></a><span class="kw">title</span>(<span class="dt">ylab=</span><span class="st">&quot;&quot;</span>,<span class="dt">cex.lab=</span><span class="fl">1.25</span>,<span class="dt">font.lab=</span><span class="dv">2</span>)</span>
<span id="cb48-18"><a href="#cb48-18"></a><span class="kw">axis</span>(<span class="dv">2</span>,<span class="dt">at=</span><span class="kw">pretty</span>(Lat),<span class="dt">tck=</span><span class="op">-</span><span class="fl">0.015</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">cex.axis=</span><span class="fl">1.25</span>,<span class="dt">font=</span><span class="dv">1</span>,<span class="dt">las=</span><span class="dv">1</span>)</span>
<span id="cb48-19"><a href="#cb48-19"></a><span class="kw">title</span>(<span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;Long term (1800-2020) mean surface temperature in Jan.&quot;</span>),</span>
<span id="cb48-20"><a href="#cb48-20"></a>      <span class="dt">cex.main=</span><span class="dv">1</span>,<span class="dt">font.main=</span><span class="dv">2</span>)</span>
<span id="cb48-21"><a href="#cb48-21"></a></span>
<span id="cb48-22"><a href="#cb48-22"></a><span class="co"># Add map</span></span>
<span id="cb48-23"><a href="#cb48-23"></a><span class="kw">map</span>(<span class="st">&#39;world&#39;</span>,<span class="dt">add=</span>T,<span class="dt">lwd=</span><span class="fl">0.75</span>,<span class="dt">col=</span><span class="st">&quot;black&quot;</span>)</span>
<span id="cb48-24"><a href="#cb48-24"></a></span>
<span id="cb48-25"><a href="#cb48-25"></a><span class="co"># Add a box</span></span>
<span id="cb48-26"><a href="#cb48-26"></a><span class="kw">box</span>(<span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb48-27"><a href="#cb48-27"></a></span>
<span id="cb48-28"><a href="#cb48-28"></a><span class="co"># Close the png file to save the file</span></span>
<span id="cb48-29"><a href="#cb48-29"></a><span class="kw">dev.off</span>()</span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
<hr />
</div>
</div>
<div id="in-class-exercises" class="section level1">
<h1>In-class exercises</h1>
<div id="exercise-1" class="section level2">
<h2>Exercise #1</h2>
<p>Can you reproduce the following figure (<code>myfirstplot.png</code>, width 25 cm, height 20 cm, and dpi 400) with <code>ggplot2</code>?</p>
<p><img src="figs/myfirstplot.png" alt="drawing" width="700"/></p>
</div>
<div id="exercise-2" class="section level2">
<h2>Exercise #2</h2>
<p>Download the monthly anomaly file (<code>air.mon.anom.nc</code>, ~ 21 MB) from <a href="ftp://ftp.cdc.noaa.gov/Datasets/cru/crutem4/std/air.mon.anom.nc">Jones (CRU) Air Temperature Anomalies Version 4: CRUTEM4</a>. Plot an image plot to show the surface air temperature monthly anomaly in the most recent month, change the plot title accordingly, and save you file as <code>Air_monthly_anomaly_recent.png</code>.</p>
<hr />
</div>
</div>
<div id="further-reading" class="section level1">
<h1>Further reading</h1>
<ul>
<li><p><a href="http://vita.had.co.nz/papers/layered-grammar.pdf">A Layered Grammar of Graphics</a></p></li>
<li><p><a href="https://ggplot2-book.org/">ggplot2: elegant graphics for data analysis</a></p></li>
<li><p><a href="https://rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf">Data Visualization with ggplot2 Cheat Sheet</a></p></li>
<li><p><a href="https://r4ds.had.co.nz/data-visualisation.html#introduction-1">Data visualisation</a></p></li>
<li><p><a href="http://r-statistics.co/ggplot2-Tutorial-With-R.html">ggplot2 Short Tutorial</a></p></li>
<li><p><a href="http://r-statistics.co/ggplot2-cheatsheet.html">ggplot2 Quickref</a></p></li>
</ul>
<hr />
</div>
<div id="references" class="section level1">
<h1>References</h1>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="http://r-statistics.co/ggplot2-Tutorial-With-R.html">How to make any plot in ggplot2?</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
